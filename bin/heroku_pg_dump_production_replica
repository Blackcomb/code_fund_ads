#!/bin/sh
rm -f ./tmp/production-shallow.dump

if [[ -z "$METABASE_URL" ]]; then
  echo "METABASE_URL environment variable not set!"
  exit 1
fi

if [[ -z "$AWS_S3_ACCESS_KEY_ID" ]]; then
  echo "AWS_S3_ACCESS_KEY_ID environment variable not set! It should be set to the production value."
  exit 1
fi

pg_dump \
  --verbose \
  --no-acl \
  --no-owner \
  --format=c \
  --exclude-schema=hdb_catalog \
  --exclude-table='impressions_*_advertiser_*' \
  --exclude-table-data='impressions_*' \
  $METABASE_URL > ./tmp/production-shallow.dump
